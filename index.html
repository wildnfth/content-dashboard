<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Content Dashboard Toko Mas Lia</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --primary:#c2185b;--primary-l:#e91e8c;--secondary:#9c27b0;--tertiary:#e040fb;
  --surface:#fff8fc;--surface2:#fce4ec;--surface3:#f3e5f5;
  --on-surface:#2d1b2e;--on-var:#7b5e7b;
  --outline:#e8c8d8;--outline-v:#f5d0e8;
  --bg:#fdf4f9;--white:#ffffff;
  --tiktok:#ff2d55;--ig:#c2185b;--yt:#e53935;
  --sh-sm:0 1px 3px rgba(194,24,91,.08),0 1px 2px rgba(156,39,176,.06);
  --sh-md:0 4px 16px rgba(194,24,91,.12),0 2px 6px rgba(156,39,176,.08);
  --sh-lg:0 8px 32px rgba(194,24,91,.16),0 4px 12px rgba(156,39,176,.10);
  --r-sm:12px;--r-md:16px;--r-lg:24px;--r-xl:32px;
  --body:'Quicksand',sans-serif;--disp:'Nunito',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--on-surface);font-family:var(--body);min-height:100vh;font-size:14px}

/* AUTH */
#auth-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#fce4ec 0%,#f3e5f5 40%,#ede7f6 100%);padding:20px;position:relative;overflow:hidden}
#auth-screen::before{content:'';position:absolute;top:-100px;right:-100px;width:400px;height:400px;background:radial-gradient(circle,rgba(224,64,251,.15) 0%,transparent 70%);pointer-events:none}
#auth-screen::after{content:'';position:absolute;bottom:-80px;left:-80px;width:300px;height:300px;background:radial-gradient(circle,rgba(194,24,91,.12) 0%,transparent 70%);pointer-events:none}
.auth-card{background:var(--white);border-radius:var(--r-xl);padding:48px 40px;width:100%;max-width:420px;box-shadow:var(--sh-lg);position:relative;z-index:1}
@media(max-width:480px){.auth-card{padding:36px 24px}}
.auth-deco{width:64px;height:64px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:20px;box-shadow:0 4px 16px rgba(194,24,91,.3)}
.auth-title{font-family:var(--disp);font-size:26px;font-weight:900;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px}
.auth-sub{font-size:13px;color:var(--on-var);margin-bottom:28px}
.tabs{display:flex;background:var(--surface2);border-radius:var(--r-md);padding:4px;margin-bottom:24px;gap:4px}
.tab-btn{flex:1;padding:10px;border:none;border-radius:var(--r-sm);background:transparent;font-family:var(--body);font-size:13px;font-weight:700;color:var(--on-var);cursor:pointer;transition:all .2s}
.tab-btn.active{background:var(--white);color:var(--primary);box-shadow:var(--sh-sm)}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:11px;font-weight:700;color:var(--on-var);margin-bottom:6px;letter-spacing:.05em;text-transform:uppercase}
.input-wrap{position:relative}
.form-input{width:100%;background:var(--surface);border:2px solid var(--outline);border-radius:var(--r-md);padding:13px 16px;color:var(--on-surface);font-family:var(--body);font-size:14px;font-weight:600;transition:border-color .2s,box-shadow .2s;outline:none}
.form-input:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(194,24,91,.1)}
.form-input.pi{padding-right:48px}
.eye-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--on-var);font-size:18px;padding:4px;line-height:1;transition:color .2s}
.eye-btn:hover{color:var(--primary)}
.btn-primary{width:100%;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border:none;border-radius:var(--r-md);padding:16px;font-family:var(--disp);font-size:15px;font-weight:800;cursor:pointer;transition:all .2s;box-shadow:0 4px 12px rgba(194,24,91,.3);letter-spacing:.03em;margin-top:4px}
.btn-primary:hover{box-shadow:0 6px 20px rgba(194,24,91,.4);transform:translateY(-1px)}
.btn-primary:active{transform:translateY(0)}
.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}
.auth-msg{border-radius:var(--r-md);padding:12px 16px;font-size:13px;font-weight:600;margin-top:14px;display:none}
.auth-err{background:#fce4ec;border:2px solid #f48fb1;color:var(--primary)}
.auth-ok{background:#e8f5e9;border:2px solid #a5d6a7;color:#2e7d32}

/* TOPBAR */
#dashboard{display:none}
.topbar{position:sticky;top:0;z-index:100;background:rgba(253,244,249,.94);backdrop-filter:blur(16px);border-bottom:1px solid var(--outline);padding:0 20px;display:flex;align-items:center;justify-content:space-between;height:64px;box-shadow:var(--sh-sm)}
.t-brand{display:flex;align-items:center;gap:10px}
.t-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px}
.t-name{font-family:var(--disp);font-size:16px;font-weight:900;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.t-right{display:flex;align-items:center;gap:10px}
.u-chip{display:flex;align-items:center;gap:8px;background:var(--surface2);border-radius:40px;padding:6px 14px 6px 6px;font-size:12px;font-weight:700;color:var(--on-var)}
.u-av{width:28px;height:28px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:11px;font-weight:800}
.btn-out{background:var(--surface2);border:none;border-radius:var(--r-sm);padding:8px 16px;color:var(--primary);font-family:var(--body);font-size:12px;font-weight:700;cursor:pointer;transition:all .2s}
.btn-out:hover{background:var(--surface3)}

/* MAIN */
.main{padding:20px;max-width:1400px;margin:0 auto}
.sec-lbl{font-family:var(--disp);font-size:13px;font-weight:800;color:var(--on-var);text-transform:uppercase;letter-spacing:.1em;margin-bottom:12px;margin-top:24px}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:8px}
@media(max-width:640px){.stats-row{grid-template-columns:1fr}}
.s-card{background:var(--white);border-radius:var(--r-lg);padding:20px;box-shadow:var(--sh-sm);border:1px solid var(--outline-v);position:relative;overflow:hidden;transition:box-shadow .2s,transform .2s}
.s-card:hover{box-shadow:var(--sh-md);transform:translateY(-2px)}
.s-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px}
.s-card.tt::before{background:linear-gradient(90deg,#ff2d55,#ff6b8a)}
.s-card.ig::before{background:linear-gradient(90deg,#c2185b,#e91e8c)}
.s-card.yt::before{background:linear-gradient(90deg,#e53935,#ef9a9a)}
.s-icon{font-size:24px;margin-bottom:8px}
.s-plat{font-size:11px;font-weight:700;color:var(--on-var);text-transform:uppercase;letter-spacing:.1em;margin-bottom:4px}
.s-val{font-family:var(--disp);font-size:28px;font-weight:900}
.s-card.tt .s-val{color:var(--tiktok)}.s-card.ig .s-val{color:var(--ig)}.s-card.yt .s-val{color:var(--yt)}
.s-sub{font-size:11px;color:var(--on-var);margin-top:4px}

/* CHARTS */
.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:8px}
.c-full{grid-column:1/-1}
@media(max-width:768px){.charts-grid{grid-template-columns:1fr}}
.c-card{background:var(--white);border-radius:var(--r-lg);padding:20px;box-shadow:var(--sh-sm);border:1px solid var(--outline-v)}
.c-title{font-family:var(--disp);font-size:14px;font-weight:800;color:var(--on-surface);margin-bottom:4px}
.c-sub{font-size:11px;color:var(--on-var);margin-bottom:16px}
.c-wrap{position:relative;height:220px}.c-wrap.tall{height:280px}

/* TABLE */
.tbl-card{background:var(--white);border-radius:var(--r-lg);box-shadow:var(--sh-sm);border:1px solid var(--outline-v);overflow:hidden}
.tbl-hdr{padding:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;border-bottom:1px solid var(--outline-v)}
.tbl-ttl{font-family:var(--disp);font-size:16px;font-weight:800;color:var(--on-surface)}
.btn-add{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border:none;border-radius:var(--r-md);padding:12px 20px;font-family:var(--disp);font-size:13px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(194,24,91,.25);transition:all .2s}
.btn-add:hover{box-shadow:0 6px 18px rgba(194,24,91,.35);transform:translateY(-1px)}
.tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;min-width:780px}
thead{background:var(--surface2)}
th{padding:14px 16px;text-align:left;font-size:11px;font-weight:800;color:var(--on-var);text-transform:uppercase;letter-spacing:.08em;white-space:nowrap;border-bottom:1px solid var(--outline)}
td{padding:14px 16px;border-bottom:1px solid var(--outline-v);font-size:13px;font-weight:600;vertical-align:middle}
tr:last-child td{border-bottom:none}
tbody tr:hover td{background:var(--surface)}
.badge-no{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;background:var(--surface2);border-radius:8px;font-size:12px;font-weight:800;color:var(--primary)}
.chip-date{background:var(--surface2);border-radius:8px;padding:4px 10px;font-size:12px;font-weight:700;color:var(--on-surface);white-space:nowrap}
.chip-time{background:linear-gradient(135deg,#fce4ec,#f3e5f5);border-radius:8px;padding:4px 10px;font-size:12px;font-weight:800;color:var(--primary);white-space:nowrap}
.code-btn{background:linear-gradient(135deg,#f3e5f5,#ede7f6);border:1.5px solid var(--outline);border-radius:var(--r-sm);padding:6px 12px;color:var(--secondary);font-family:var(--disp);font-size:12px;font-weight:800;cursor:pointer;transition:all .2s;white-space:nowrap}
.code-btn:hover{background:linear-gradient(135deg,var(--secondary),var(--tertiary));color:#fff;border-color:transparent;box-shadow:0 4px 12px rgba(156,39,176,.3);transform:scale(1.04)}
.v-cell{display:flex;flex-direction:column;gap:3px}
.v-row{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:700}
.v-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.v-dot.tt{background:var(--tiktok)}.v-dot.ig{background:var(--ig)}.v-dot.yt{background:var(--yt)}
.act-cell{display:flex;gap:6px}
.btn-edit{background:var(--surface3);border:none;border-radius:var(--r-sm);padding:7px 12px;color:var(--secondary);font-family:var(--body);font-size:12px;font-weight:700;cursor:pointer;transition:all .2s}
.btn-edit:hover{background:var(--secondary);color:#fff}
.btn-del{background:#fce4ec;border:none;border-radius:var(--r-sm);padding:7px 12px;color:var(--tiktok);font-family:var(--body);font-size:12px;font-weight:700;cursor:pointer;transition:all .2s}
.btn-del:hover{background:var(--tiktok);color:#fff}
.empty-st{text-align:center;padding:60px 20px;color:var(--on-var)}
.empty-ic{font-size:48px;margin-bottom:12px}
.empty-tx{font-size:14px;font-weight:600}

/* OVERLAY & MODAL */
.overlay{position:fixed;inset:0;background:rgba(45,27,46,.5);backdrop-filter:blur(6px);z-index:200;display:none;align-items:center;justify-content:center;padding:16px}
.overlay.open{display:flex}
.modal{background:var(--white);border-radius:var(--r-xl);width:100%;max-width:540px;max-height:90vh;overflow-y:auto;-webkit-overflow-scrolling:touch;box-shadow:var(--sh-lg)}
.m-hdr{padding:24px 24px 0;display:flex;align-items:center;justify-content:space-between}
.m-ttl{font-family:var(--disp);font-size:20px;font-weight:900;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.m-x{background:var(--surface2);border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;color:var(--on-var);font-size:16px;cursor:pointer;transition:all .2s}
.m-x:hover{background:var(--surface3);color:var(--primary)}
.m-body{padding:20px 24px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:480px){.g2{grid-template-columns:1fr}}
.full{grid-column:1/-1}
.m-ftr{padding:0 24px 24px;display:flex;gap:10px;justify-content:flex-end}
.btn-cancel{background:var(--surface2);border:none;border-radius:var(--r-md);padding:12px 20px;color:var(--on-var);font-family:var(--body);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s}
.btn-cancel:hover{background:var(--surface3)}
.btn-save{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border:none;border-radius:var(--r-md);padding:12px 24px;font-family:var(--disp);font-size:13px;font-weight:800;cursor:pointer;box-shadow:0 4px 12px rgba(194,24,91,.25);transition:all .2s}
.btn-save:hover{box-shadow:0 6px 18px rgba(194,24,91,.35)}
.btn-save:disabled{opacity:.5;cursor:not-allowed}

/* TIME PICKER */
.tp-box{background:var(--white);border-radius:var(--r-xl);width:100%;max-width:300px;padding:28px;box-shadow:var(--sh-lg)}
.tp-ttl{font-family:var(--disp);font-size:16px;font-weight:900;text-align:center;margin-bottom:8px;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.tp-disp{font-family:var(--disp);font-size:52px;font-weight:900;text-align:center;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:24px;letter-spacing:.04em}
.tp-cols{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.tp-col-lbl{font-size:11px;font-weight:800;color:var(--on-var);text-transform:uppercase;letter-spacing:.1em;text-align:center;margin-bottom:8px}
.spin{display:flex;flex-direction:column;align-items:center;gap:8px}
.spin-btn{width:44px;height:40px;background:var(--surface2);border:2px solid var(--outline);border-radius:var(--r-sm);color:var(--primary);font-size:18px;font-weight:800;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}
.spin-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary)}
.spin-val{font-family:var(--disp);font-size:28px;font-weight:900;width:56px;text-align:center;background:var(--surface2);border:2px solid var(--outline);border-radius:var(--r-sm);padding:6px;color:var(--on-surface)}
.tp-btns{display:flex;gap:10px}

/* LINKS POPUP */
.lnk-box{background:var(--white);border-radius:var(--r-xl);width:100%;max-width:360px;padding:28px;box-shadow:var(--sh-lg)}
.lnk-lbl{font-size:11px;font-weight:800;color:var(--on-var);text-transform:uppercase;letter-spacing:.1em}
.lnk-code{font-family:var(--disp);font-size:22px;font-weight:900;background:linear-gradient(135deg,var(--secondary),var(--tertiary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:20px}
.lnk-item{display:flex;align-items:center;gap:14px;padding:14px 16px;border-radius:var(--r-md);border:2px solid var(--outline);text-decoration:none;color:var(--on-surface);margin-bottom:10px;transition:all .2s;font-weight:600}
.lnk-item.dis{opacity:.4;pointer-events:none}
.lnk-item:not(.dis):hover{transform:translateX(6px)}
.lnk-item.ltt:not(.dis):hover{border-color:var(--tiktok);background:#fff5f7}
.lnk-item.lig:not(.dis):hover{border-color:var(--ig);background:#fdf0f5}
.lnk-item.lyt:not(.dis):hover{border-color:var(--yt);background:#fff5f5}
.lnk-ic{font-size:22px;flex-shrink:0}
.lnk-info{flex:1;min-width:0}
.lnk-plat{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.1em;color:var(--on-var)}
.lnk-url{font-size:12px;color:var(--on-var);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lnk-arrow{color:var(--on-var);font-size:16px;flex-shrink:0}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;background:var(--on-surface);color:#fff;border-radius:var(--r-md);padding:14px 20px;font-size:13px;font-weight:700;z-index:999;transform:translateY(80px);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);display:flex;align-items:center;gap:10px;max-width:320px;box-shadow:var(--sh-lg)}
.toast.show{transform:translateY(0);opacity:1}
.toast.ok{background:#2e7d32}.toast.err{background:#c62828}

input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none}
input[type=number]{-moz-appearance:textfield}
</style>
</head>
<body>

<!-- AUTH -->
<div id="auth-screen">
  <div class="auth-card">
    <div class="auth-deco">üíé</div>
    <div class="auth-title">Content Dashboard</div>
    <div class="auth-sub">Toko Mas Lia ‚ú®</div>
    <div class="tabs">
      <button class="tab-btn active" id="tab-masuk" onclick="switchTab('masuk')">Masuk</button>
      <button class="tab-btn" id="tab-daftar" onclick="switchTab('daftar')">Daftar</button>
    </div>
    <!-- LOGIN -->
    <div id="form-masuk">
      <div class="form-group">
        <label class="form-label">Username</label>
        <input type="text" id="l-user" class="form-input" placeholder="username kamu" autocomplete="username"/>
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <div class="input-wrap">
          <input type="password" id="l-pw" class="form-input pi" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
          <button class="eye-btn" type="button" onclick="togglePw('l-pw',this)">üëÅÔ∏è</button>
        </div>
      </div>
      <button class="btn-primary" id="btn-login">Masuk ‚Üí</button>
    </div>
    <!-- REGISTER -->
    <div id="form-daftar" style="display:none">
      <div class="form-group">
        <label class="form-label">Username</label>
        <input type="text" id="r-user" class="form-input" placeholder="pilih username unik" autocomplete="username"/>
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <div class="input-wrap">
          <input type="password" id="r-pw" class="form-input pi" placeholder="min. 6 karakter" autocomplete="new-password"/>
          <button class="eye-btn" type="button" onclick="togglePw('r-pw',this)">üëÅÔ∏è</button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Konfirmasi Password</label>
        <div class="input-wrap">
          <input type="password" id="r-pw2" class="form-input pi" placeholder="ulangi password" autocomplete="new-password"/>
          <button class="eye-btn" type="button" onclick="togglePw('r-pw2',this)">üëÅÔ∏è</button>
        </div>
      </div>
      <button class="btn-primary" id="btn-register">Buat Akun ‚ú®</button>
    </div>
    <div class="auth-msg auth-err" id="auth-err"></div>
    <div class="auth-msg auth-ok" id="auth-ok"></div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="topbar">
    <div class="t-brand">
      <div class="t-icon">üíé</div>
      <div class="t-name">Toko Mas Lia</div>
    </div>
    <div class="t-right">
      <div class="u-chip"><div class="u-av" id="u-av">?</div><span id="u-lbl">‚Äî</span></div>
      <button class="btn-out" id="btn-out">Keluar</button>
    </div>
  </div>
  <div class="main">
    <div class="sec-lbl">üìä Ringkasan Total Views</div>
    <div class="stats-row">
      <div class="s-card tt"><div class="s-icon">üéµ</div><div class="s-plat">TikTok</div><div class="s-val" id="sv-tt">0</div><div class="s-sub">total views</div></div>
      <div class="s-card ig"><div class="s-icon">üì∏</div><div class="s-plat">Instagram</div><div class="s-val" id="sv-ig">0</div><div class="s-sub">total views</div></div>
      <div class="s-card yt"><div class="s-icon">‚ñ∂Ô∏è</div><div class="s-plat">YouTube</div><div class="s-val" id="sv-yt">0</div><div class="s-sub">total views</div></div>
    </div>
    <div class="sec-lbl">üìà Analisis Performa</div>
    <div class="charts-grid">
      <div class="c-card c-full"><div class="c-title">üìÖ Trend Views per Tanggal</div><div class="c-sub">Total views harian dari semua platform</div><div class="c-wrap tall"><canvas id="ch-trend"></canvas></div></div>
      <div class="c-card"><div class="c-title">üèÜ Perbandingan Platform</div><div class="c-sub">Distribusi total views per platform</div><div class="c-wrap"><canvas id="ch-donut"></canvas></div></div>
      <div class="c-card"><div class="c-title">‚≠ê Top 5 Video</div><div class="c-sub">Video dengan views terbanyak (gabungan)</div><div class="c-wrap"><canvas id="ch-top"></canvas></div></div>
      <div class="c-card c-full"><div class="c-title">üìä Breakdown Views per Video</div><div class="c-sub">Perbandingan views tiap platform per kode video (10 terakhir)</div><div class="c-wrap tall"><canvas id="ch-bar"></canvas></div></div>
    </div>
    <div class="sec-lbl">üé¨ Daftar Post</div>
    <div class="tbl-card">
      <div class="tbl-hdr">
        <div class="tbl-ttl">Semua Post</div>
        <button class="btn-add" id="btn-add">Ôºã Tambah Post</button>
      </div>
      <div class="tbl-wrap">
        <table>
          <thead><tr><th>No.</th><th>Tanggal</th><th>Jam</th><th>Kode Video</th><th>Views</th><th>Aksi</th></tr></thead>
          <tbody id="tbody"><tr><td colspan="6"><div class="empty-st"><div class="empty-ic">üå∏</div><div class="empty-tx">Memuat data...</div></div></td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- MODAL POST -->
<div class="overlay" id="ov-post">
  <div class="modal">
    <div class="m-hdr"><div class="m-ttl" id="m-ttl">Tambah Post</div><button class="m-x" id="m-x">‚úï</button></div>
    <div class="m-body">
      <div class="g2">
        <div><label class="form-label">Tanggal</label><input type="date" id="f-tgl" class="form-input"/></div>
        <div><label class="form-label">Jam Upload</label><div class="input-wrap"><input type="text" id="f-jam" class="form-input" placeholder="Ketuk untuk pilih jam" readonly style="cursor:pointer"/></div></div>
        <div class="full"><label class="form-label">Kode Video</label><input type="text" id="f-kode" class="form-input" placeholder="VID-001"/></div>
        <div class="full"><label class="form-label">Link TikTok</label><input type="url" id="f-tt" class="form-input" placeholder="https://tiktok.com/@..."/></div>
        <div class="full"><label class="form-label">Link Instagram</label><input type="url" id="f-ig" class="form-input" placeholder="https://instagram.com/p/..."/></div>
        <div class="full"><label class="form-label">Link YouTube</label><input type="url" id="f-yt" class="form-input" placeholder="https://youtube.com/watch?v=..."/></div>
        <div><label class="form-label">Views TikTok</label><input type="number" id="f-vtt" class="form-input" placeholder="0" min="0"/></div>
        <div><label class="form-label">Views Instagram</label><input type="number" id="f-vig" class="form-input" placeholder="0" min="0"/></div>
        <div class="full"><label class="form-label">Views YouTube</label><input type="number" id="f-vyt" class="form-input" placeholder="0" min="0"/></div>
      </div>
    </div>
    <div class="m-ftr"><button class="btn-cancel" id="m-cancel">Batal</button><button class="btn-save" id="m-save">Simpan ‚ú®</button></div>
  </div>
</div>

<!-- MODAL TIME PICKER -->
<div class="overlay" id="ov-time">
  <div class="tp-box">
    <div class="tp-ttl">üïê Pilih Jam Upload</div>
    <div class="tp-disp" id="tp-disp">00:00</div>
    <div class="tp-cols">
      <div><div class="tp-col-lbl">Jam</div><div class="spin"><button class="spin-btn" id="h-up">‚ñ≤</button><div class="spin-val" id="h-val">00</div><button class="spin-btn" id="h-dn">‚ñº</button></div></div>
      <div><div class="tp-col-lbl">Menit</div><div class="spin"><button class="spin-btn" id="m-up">‚ñ≤</button><div class="spin-val" id="m-val">00</div><button class="spin-btn" id="m-dn">‚ñº</button></div></div>
    </div>
    <div class="tp-btns"><button class="btn-cancel" style="flex:1" id="tp-cancel">Batal</button><button class="btn-save" style="flex:1" id="tp-ok">Pilih ‚úì</button></div>
  </div>
</div>

<!-- MODAL LINKS -->
<div class="overlay" id="ov-links">
  <div class="lnk-box">
    <div class="lnk-lbl">Kode Video</div>
    <div class="lnk-code" id="lnk-code">‚Äî</div>
    <a class="lnk-item ltt" id="lnk-tt" href="#" target="_blank" rel="noopener"><div class="lnk-ic">üéµ</div><div class="lnk-info"><div class="lnk-plat">TikTok</div><div class="lnk-url" id="lnk-tt-url">Tidak ada link</div></div><span class="lnk-arrow">‚Üí</span></a>
    <a class="lnk-item lig" id="lnk-ig" href="#" target="_blank" rel="noopener"><div class="lnk-ic">üì∏</div><div class="lnk-info"><div class="lnk-plat">Instagram</div><div class="lnk-url" id="lnk-ig-url">Tidak ada link</div></div><span class="lnk-arrow">‚Üí</span></a>
    <a class="lnk-item lyt" id="lnk-yt" href="#" target="_blank" rel="noopener"><div class="lnk-ic">‚ñ∂Ô∏è</div><div class="lnk-info"><div class="lnk-plat">YouTube</div><div class="lnk-url" id="lnk-yt-url">Tidak ada link</div></div><span class="lnk-arrow">‚Üí</span></a>
    <button class="btn-cancel" style="width:100%;margin-top:16px" id="lnk-close">Tutup</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const SUPABASE_URL='https://bvkrqzmcdpkkrldakdcf.supabase.co';
const SUPABASE_ANON_KEY='sb_publishable_LSYHeAlqbAHt-uqJ65_sMg_0x3yV3zw';
const {createClient}=supabase;
const sb=createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

// UTILS
const p2=n=>String(n).padStart(2,'0');
const nowTime=()=>{const d=new Date();return`${p2(d.getHours())}:${p2(d.getMinutes())}`;};
const todayStr=()=>new Date().toISOString().split('T')[0];
function fmtV(n){if(n==null||n===''||isNaN(n))return'‚Äî';n=parseInt(n);if(n>=1000000)return(n/1e6).toFixed(1)+'M';if(n>=1000)return(n/1000).toFixed(1)+'K';return n.toLocaleString('id-ID');}
function fmtD(d){if(!d)return'‚Äî';return new Date(d+'T00:00:00').toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'});}
function showToast(msg,type='ok'){const el=document.getElementById('toast');el.innerHTML=`<span>${type==='ok'?'‚úÖ':'‚ùå'}</span><span>${msg}</span>`;el.className=`toast show ${type}`;setTimeout(()=>el.className='toast',3000);}

// AUTH HELPERS
function switchTab(t){
  document.getElementById('form-masuk').style.display=t==='masuk'?'block':'none';
  document.getElementById('form-daftar').style.display=t==='daftar'?'block':'none';
  document.getElementById('tab-masuk').className='tab-btn'+(t==='masuk'?' active':'');
  document.getElementById('tab-daftar').className='tab-btn'+(t==='daftar'?' active':'');
  document.getElementById('auth-err').style.display='none';
  document.getElementById('auth-ok').style.display='none';
}
function togglePw(id,btn){const i=document.getElementById(id);if(i.type==='password'){i.type='text';btn.textContent='üôà';}else{i.type='password';btn.textContent='üëÅÔ∏è';}}
function showErr(msg){const e=document.getElementById('auth-err');e.textContent=msg;e.style.display='block';document.getElementById('auth-ok').style.display='none';}
function showOk(msg){const e=document.getElementById('auth-ok');e.textContent=msg;e.style.display='block';document.getElementById('auth-err').style.display='none';}
const uToEmail=u=>`${u.toLowerCase().replace(/[^a-z0-9]/g,'_')}@tokomaslia.internal`;

// LOGIN
document.getElementById('btn-login').addEventListener('click',async()=>{
  const u=document.getElementById('l-user').value.trim();
  const p=document.getElementById('l-pw').value;
  document.getElementById('auth-err').style.display='none';
  if(!u||!p){showErr('Username dan password wajib diisi.');return;}
  const btn=document.getElementById('btn-login');
  btn.disabled=true;btn.textContent='Memuat...';
  const{error}=await sb.auth.signInWithPassword({email:uToEmail(u),password:p});
  btn.disabled=false;btn.textContent='Masuk ‚Üí';
  if(error)showErr('Username atau password salah.');
});
document.getElementById('l-pw').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('btn-login').click();});

// REGISTER
document.getElementById('btn-register').addEventListener('click',async()=>{
  const u=document.getElementById('r-user').value.trim();
  const p=document.getElementById('r-pw').value;
  const p2=document.getElementById('r-pw2').value;
  document.getElementById('auth-err').style.display='none';
  if(!u){showErr('Username wajib diisi.');return;}
  if(u.length<3){showErr('Username minimal 3 karakter.');return;}
  if(p.length<6){showErr('Password minimal 6 karakter.');return;}
  if(p!==p2){showErr('Konfirmasi password tidak sama.');return;}
  const btn=document.getElementById('btn-register');
  btn.disabled=true;btn.textContent='Mendaftar...';
  const{error}=await sb.auth.signUp({email:uToEmail(u),password:p,options:{data:{username:u}}});
  btn.disabled=false;btn.textContent='Buat Akun ‚ú®';
  if(error){showErr('Gagal mendaftar: '+error.message);return;}
  showOk('Akun berhasil dibuat! Silakan masuk.');
  setTimeout(()=>switchTab('masuk'),1500);
});

// LOGOUT
document.getElementById('btn-out').addEventListener('click',()=>sb.auth.signOut());

// AUTH STATE
sb.auth.onAuthStateChange((ev,session)=>{
  if(session){
    document.getElementById('auth-screen').style.display='none';
    document.getElementById('dashboard').style.display='block';
    const meta=session.user.user_metadata;
    const uname=meta?.username||session.user.email.split('@')[0];
    document.getElementById('u-lbl').textContent=uname;
    document.getElementById('u-av').textContent=uname[0].toUpperCase();
    loadAll();
  }else{
    document.getElementById('auth-screen').style.display='flex';
    document.getElementById('dashboard').style.display='none';
  }
});

// DATA
let allPosts=[];
async function loadAll(){
  const{data,error}=await sb.from('posts').select('*').order('tanggal',{ascending:true}).order('nomor',{ascending:true});
  if(error){showToast('Gagal memuat data','err');return;}
  allPosts=data||[];
  renderTable(allPosts);
  renderStats(allPosts);
  renderCharts(allPosts);
}

async function getNextNomor(tanggal,excludeId=null){
  let q=sb.from('posts').select('nomor').eq('tanggal',tanggal).order('nomor',{ascending:false}).limit(1);
  if(excludeId) q=q.neq('id',excludeId);
  const{data}=await q;
  if(!data||!data.length)return 1;
  return(data[0].nomor||0)+1;
}

// STATS
function renderStats(data){
  document.getElementById('sv-tt').textContent=fmtV(data.reduce((s,r)=>s+(parseInt(r.views_tiktok)||0),0));
  document.getElementById('sv-ig').textContent=fmtV(data.reduce((s,r)=>s+(parseInt(r.views_instagram)||0),0));
  document.getElementById('sv-yt').textContent=fmtV(data.reduce((s,r)=>s+(parseInt(r.views_youtube)||0),0));
}

// CHARTS
const CI={};
function dc(id){if(CI[id]){CI[id].destroy();delete CI[id];}}
const C={tt:'rgba(255,45,85,.85)',ttL:'rgba(255,45,85,.2)',ig:'rgba(194,24,91,.85)',igL:'rgba(194,24,91,.2)',yt:'rgba(229,57,53,.85)',ytL:'rgba(229,57,53,.2)'};

function renderCharts(data){
  // TREND
  dc('ch-trend');
  const bd={};
  data.forEach(r=>{const d=r.tanggal||'?';if(!bd[d])bd[d]={tt:0,ig:0,yt:0};bd[d].tt+=parseInt(r.views_tiktok)||0;bd[d].ig+=parseInt(r.views_instagram)||0;bd[d].yt+=parseInt(r.views_youtube)||0;});
  const dl=Object.keys(bd).sort();
  if(dl.length){
    CI['ch-trend']=new Chart(document.getElementById('ch-trend'),{type:'line',data:{labels:dl.map(d=>fmtD(d)),datasets:[{label:'TikTok',data:dl.map(d=>bd[d].tt),borderColor:C.tt,backgroundColor:C.ttL,tension:.4,fill:true,pointRadius:4,pointHoverRadius:7},{label:'Instagram',data:dl.map(d=>bd[d].ig),borderColor:C.ig,backgroundColor:C.igL,tension:.4,fill:true,pointRadius:4,pointHoverRadius:7},{label:'YouTube',data:dl.map(d=>bd[d].yt),borderColor:C.yt,backgroundColor:C.ytL,tension:.4,fill:true,pointRadius:4,pointHoverRadius:7}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{font:{family:'Quicksand',weight:'700'},boxRadius:6,padding:16}}},scales:{x:{grid:{color:'rgba(194,24,91,.06)'},ticks:{font:{family:'Quicksand',size:11}}},y:{grid:{color:'rgba(194,24,91,.06)'},ticks:{font:{family:'Quicksand',size:11},callback:v=>fmtV(v)}}}}});
  }

  // DONUT
  dc('ch-donut');
  const ttt=data.reduce((s,r)=>s+(parseInt(r.views_tiktok)||0),0);
  const tig=data.reduce((s,r)=>s+(parseInt(r.views_instagram)||0),0);
  const tyt=data.reduce((s,r)=>s+(parseInt(r.views_youtube)||0),0);
  CI['ch-donut']=new Chart(document.getElementById('ch-donut'),{type:'doughnut',data:{labels:['TikTok','Instagram','YouTube'],datasets:[{data:[ttt,tig,tyt],backgroundColor:[C.tt,C.ig,C.yt],borderWidth:0,hoverOffset:8}]},options:{responsive:true,maintainAspectRatio:false,cutout:'65%',plugins:{legend:{position:'bottom',labels:{font:{family:'Quicksand',weight:'700'},boxRadius:6,padding:16}},tooltip:{callbacks:{label:ctx=>`${ctx.label}: ${fmtV(ctx.parsed)}`}}}}});

  // TOP 5
  dc('ch-top');
  const scored=data.map(r=>({kode:r.kode_video||'?',total:(parseInt(r.views_tiktok)||0)+(parseInt(r.views_instagram)||0)+(parseInt(r.views_youtube)||0)})).sort((a,b)=>b.total-a.total).slice(0,5);
  if(scored.length){
    CI['ch-top']=new Chart(document.getElementById('ch-top'),{type:'bar',data:{labels:scored.map(r=>r.kode),datasets:[{label:'Total Views',data:scored.map(r=>r.total),backgroundColor:['rgba(194,24,91,.85)','rgba(156,39,176,.85)','rgba(224,64,251,.85)','rgba(255,45,85,.75)','rgba(230,74,150,.75)'],borderRadius:10,borderSkipped:false}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`${fmtV(ctx.parsed.x)} views`}}},scales:{x:{grid:{color:'rgba(194,24,91,.06)'},ticks:{font:{family:'Quicksand',size:11},callback:v=>fmtV(v)}},y:{grid:{display:false},ticks:{font:{family:'Quicksand',size:11,weight:'700'}}}}}});
  }

  // BREAKDOWN
  dc('ch-bar');
  const recent=data.slice(-10);
  if(recent.length){
    CI['ch-bar']=new Chart(document.getElementById('ch-bar'),{type:'bar',data:{labels:recent.map(r=>r.kode_video||'?'),datasets:[{label:'TikTok',data:recent.map(r=>parseInt(r.views_tiktok)||0),backgroundColor:C.tt,borderRadius:6,borderSkipped:false},{label:'Instagram',data:recent.map(r=>parseInt(r.views_instagram)||0),backgroundColor:C.ig,borderRadius:6,borderSkipped:false},{label:'YouTube',data:recent.map(r=>parseInt(r.views_youtube)||0),backgroundColor:C.yt,borderRadius:6,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{font:{family:'Quicksand',weight:'700'},boxRadius:6,padding:16}}},scales:{x:{grid:{display:false},ticks:{font:{family:'Quicksand',size:11}}},y:{grid:{color:'rgba(194,24,91,.06)'},ticks:{font:{family:'Quicksand',size:11},callback:v=>fmtV(v)}}}}});
  }
}

// TABLE
function renderTable(data){
  const tb=document.getElementById('tbody');
  const sorted=[...data].sort((a,b)=>{if(b.tanggal>a.tanggal)return 1;if(b.tanggal<a.tanggal)return-1;return(a.nomor||0)-(b.nomor||0);});
  if(!sorted.length){tb.innerHTML=`<tr><td colspan="6"><div class="empty-st"><div class="empty-ic">üå∏</div><div class="empty-tx">Belum ada data. Yuk tambah post pertama!</div></div></td></tr>`;return;}
  tb.innerHTML=sorted.map(r=>`<tr>
    <td><span class="badge-no">${r.nomor||'?'}</span></td>
    <td><span class="chip-date">${fmtD(r.tanggal)}</span></td>
    <td><span class="chip-time">${r.jam_upload||'‚Äî'}</span></td>
    <td><button class="code-btn" onclick='openLinks(${JSON.stringify(r).replace(/'/g,"&#39;")})'>${r.kode_video||'‚Äî'}</button></td>
    <td><div class="v-cell"><div class="v-row"><span class="v-dot tt"></span>${fmtV(r.views_tiktok)}</div><div class="v-row"><span class="v-dot ig"></span>${fmtV(r.views_instagram)}</div><div class="v-row"><span class="v-dot yt"></span>${fmtV(r.views_youtube)}</div></div></td>
    <td><div class="act-cell"><button class="btn-edit" onclick='openEdit(${JSON.stringify(r).replace(/'/g,"&#39;")})'>‚úèÔ∏è Edit</button><button class="btn-del" onclick="delPost('${r.id}')">üóëÔ∏è Hapus</button></div></td>
  </tr>`).join('');
}

// LINKS POPUP
function openLinks(r){
  document.getElementById('lnk-code').textContent=r.kode_video||'‚Äî';
  function setL(aid,uid,url){const a=document.getElementById(aid);const u=document.getElementById(uid);if(url){a.href=url;u.textContent=url.replace('https://','').substring(0,38)+(url.length>41?'‚Ä¶':'');a.classList.remove('dis');}else{a.href='#';u.textContent='Tidak ada link';a.classList.add('dis');}}
  setL('lnk-tt','lnk-tt-url',r.link_tiktok);setL('lnk-ig','lnk-ig-url',r.link_instagram);setL('lnk-yt','lnk-yt-url',r.link_youtube);
  document.getElementById('ov-links').classList.add('open');
}
document.getElementById('lnk-close').addEventListener('click',()=>document.getElementById('ov-links').classList.remove('open'));
document.getElementById('ov-links').addEventListener('click',e=>{if(e.target===document.getElementById('ov-links'))document.getElementById('ov-links').classList.remove('open');});

// TIME PICKER
let tH=0,tM=0;
function updTP(){document.getElementById('h-val').textContent=p2(tH);document.getElementById('m-val').textContent=p2(tM);document.getElementById('tp-disp').textContent=`${p2(tH)}:${p2(tM)}`;}
document.getElementById('h-up').addEventListener('click',()=>{tH=(tH+1)%24;updTP();});
document.getElementById('h-dn').addEventListener('click',()=>{tH=(tH-1+24)%24;updTP();});
document.getElementById('m-up').addEventListener('click',()=>{tM=(tM+1)%60;updTP();});
document.getElementById('m-dn').addEventListener('click',()=>{tM=(tM-1+60)%60;updTP();});
document.getElementById('f-jam').addEventListener('click',()=>{
  const cur=document.getElementById('f-jam').value;
  if(cur){const[h,m]=cur.split(':');tH=parseInt(h);tM=parseInt(m);}
  else{const n=nowTime().split(':');tH=parseInt(n[0]);tM=parseInt(n[1]);}
  updTP();document.getElementById('ov-time').classList.add('open');
});
document.getElementById('tp-ok').addEventListener('click',()=>{document.getElementById('f-jam').value=`${p2(tH)}:${p2(tM)}`;document.getElementById('ov-time').classList.remove('open');});
document.getElementById('tp-cancel').addEventListener('click',()=>document.getElementById('ov-time').classList.remove('open'));

// POST MODAL
let editId=null;
function clearForm(){['f-tgl','f-jam','f-kode','f-tt','f-ig','f-yt','f-vtt','f-vig','f-vyt'].forEach(id=>document.getElementById(id).value='');}

document.getElementById('btn-add').addEventListener('click',()=>{
  editId=null;clearForm();
  document.getElementById('f-tgl').value=todayStr();
  document.getElementById('f-jam').value=nowTime();
  document.getElementById('m-ttl').textContent='Tambah Post';
  document.getElementById('ov-post').classList.add('open');
});

function openEdit(r){
  editId=r.id;
  document.getElementById('m-ttl').textContent='Edit Post';
  document.getElementById('f-tgl').value=r.tanggal||'';
  document.getElementById('f-jam').value=r.jam_upload||'';
  document.getElementById('f-kode').value=r.kode_video||'';
  document.getElementById('f-tt').value=r.link_tiktok||'';
  document.getElementById('f-ig').value=r.link_instagram||'';
  document.getElementById('f-yt').value=r.link_youtube||'';
  document.getElementById('f-vtt').value=r.views_tiktok??'';
  document.getElementById('f-vig').value=r.views_instagram??'';
  document.getElementById('f-vyt').value=r.views_youtube??'';
  document.getElementById('ov-post').classList.add('open');
}

function closePost(){document.getElementById('ov-post').classList.remove('open');editId=null;}
document.getElementById('m-x').addEventListener('click',closePost);
document.getElementById('m-cancel').addEventListener('click',closePost);
document.getElementById('ov-post').addEventListener('click',e=>{if(e.target===document.getElementById('ov-post'))closePost();});

document.getElementById('m-save').addEventListener('click',async()=>{
  const tanggal=document.getElementById('f-tgl').value;
  const kode=document.getElementById('f-kode').value.trim();
  if(!tanggal){showToast('Tanggal wajib diisi','err');return;}
  if(!kode){showToast('Kode video wajib diisi','err');return;}

  // CEK DUPLIKAT KODE VIDEO
  const dup=allPosts.find(p=>p.kode_video===kode&&p.id!==editId);
  if(dup){showToast(`Kode "${kode}" sudah dipakai! Gunakan kode lain.`,'err');return;}

  const btn=document.getElementById('m-save');
  btn.disabled=true;btn.textContent='Menyimpan...';

  // AUTO NOMOR
  let nomor;
  if(editId){
    const cur=allPosts.find(p=>p.id===editId);
    if(cur?.tanggal===tanggal){nomor=cur.nomor;}
    else{nomor=await getNextNomor(tanggal,editId);}
  }else{
    nomor=await getNextNomor(tanggal);
  }

  const payload={
    tanggal,nomor,
    jam_upload:document.getElementById('f-jam').value||null,
    kode_video:kode,
    link_tiktok:document.getElementById('f-tt').value.trim()||null,
    link_instagram:document.getElementById('f-ig').value.trim()||null,
    link_youtube:document.getElementById('f-yt').value.trim()||null,
    views_tiktok:parseInt(document.getElementById('f-vtt').value)||0,
    views_instagram:parseInt(document.getElementById('f-vig').value)||0,
    views_youtube:parseInt(document.getElementById('f-vyt').value)||0,
  };

  let error;
  if(editId)({error}=await sb.from('posts').update(payload).eq('id',editId));
  else({error}=await sb.from('posts').insert(payload));

  btn.disabled=false;btn.textContent='Simpan ‚ú®';
  if(error){showToast('Gagal menyimpan: '+error.message,'err');return;}
  showToast(editId?'Post berhasil diperbarui! ‚ú®':'Post berhasil ditambahkan! üéâ');
  closePost();loadAll();
});

// DELETE
async function delPost(id){
  if(!confirm('Yakin hapus post ini? Tidak bisa dibatalkan ya! ü•∫'))return;
  const{error}=await sb.from('posts').delete().eq('id',id);
  if(error){showToast('Gagal menghapus','err');return;}
  showToast('Post dihapus üóëÔ∏è');loadAll();
}
</script>
</body>
</html>
